# .github/workflows/label-merged-pr.yml
name: Label Merged PR on Push

on:
  push:
    branches: [ main ]

permissions:
  contents: read          # you donâ€™t need to write files
  pull-requests: write    # to write labels on PRs

jobs:
  label-merged-pr:
    runs-on: ubuntu-latest
    steps:
      - name: Find PR for this merge commit
        id: find_pr
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const { data } = await github.rest.repos.listPullRequestsAssociatedWithCommit({
              owner: context.repo.owner,
              repo:  context.repo.repo,
              commit_sha: context.sha
            });
            const pr = data.find(p => p.merged_at);
            if (!pr) core.setFailed(`No merged PR for ${context.sha}`);
            echo "number=$pr.number" >> $GITHUB_OUTPUT

      - name: Label the PR
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            await github.rest.issues.addLabels({
              owner:        context.repo.owner,
              repo:         context.repo.repo,
              issue_number: ${{ steps.find_pr.outputs.number }}  ,
              labels: ['kind/feature']
            });